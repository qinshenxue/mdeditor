(function(e){var t=function(e){return new t.prototype.init(e)};t.prototype={init:function(e){var t=this;var r={id:"",placeholder:"",name:"",aTarget:"_blank"};if(e&&e.id){t.copy(r,e);var n=this.getDom(e.id);var i='<textarea id="mdeditor" class="mdeditor" name="{name}" placeholder="{placeholder}"></textarea><div id="mdeditor-html" class="mdeditor-html"></div>';i=t.formatString(i,r);n.innerHTML=i;var a=this.getDom("mdeditor");var l=this.getDom("mdeditor-html");a.addEventListener("input",function(){var e=this.value;t.markdownToHtml(e)});t.editor=a;t.editor2Html=l}t.options=r;return t},regLib:{code:/^\`{3}.*$/,ul:/^[\.\-\*]\s?.+$/,ol:/^\d+\.\s?.+$/,toc:/^\s*\[TOC\]\s*$/,img:/\!\[(.*?)\]\((.*?)\)/g,title:/^#{1,6}.+$/,a:/\[(.*?)\]\((.*?)\)/g,b:/\*\*(.+?)\*\*/g,inlinecode:/\`(.+?)\`/g},formatString:function(e,t){return e.replace(/{\w+}/g,function(e){var r=e.substr(1,e.length-2);return t[r]})},copy:function(e,t){for(var r in t){e[r]=t[r]}return e},getDom:function(e){return document.getElementById(e)},getMarkdown:function(){if(this.editor){return this.editor.value}else{return null}},setMarkdown:function(e){if(this.editor){this.editor.value=e}return this.markdownToHtml(e)},getHTML:function(){if(this.editor2Html){return this.editor2Html.innerHTML}else{return""}},markdownToHtml:function(e){var t=this;var r=e.match(/.+/gm)||[];var n=[];var i="";var a="";var l=r.length;var o=0;var s=null;if(l&&t.regLib.toc.test(r[0])){o=1;s=['<div class="mdeditor-toc">']}for(var d=o;d<l;d++){var u=r[d];switch(i){case"ol":if(!t.regLib.ol.test(u)){d--;i="";n.push("</ol>")}else{n.push(t.handleOrderList(u));if(d==l-1){n.push("</ol>")}}break;case"ul":if(!t.regLib.ul.test(u)){d--;i="";n.push("</ul>")}else{n.push(t.handleUnorderedList(u));if(d==l-1){n.push("</ul>")}}break;case"code":if(t.regLib.code.test(u)){i="";n.push("</code>");n.push("</pre>")}else{n.push("<li>"+t.handleCodeType(a,u)+"</li>")}break;default:if(t.regLib.title.test(u)){n.push(t.handleTitle(u,s))}else if(t.regLib.ol.test(u)){d--;i="ol";n.push('<ol  class="mdeditor-ol">')}else if(t.regLib.ul.test(u)){d--;i="ul";n.push('<ul  class="mdeditor-ul">')}else if(t.regLib.code.test(u)){i="code";a=u.replace(/[`\s]/g,"");n.push('<pre class="mdeditor-code mdeditor-code-'+a.toLowerCase()+'">');n.push("<ol>")}else if(t.regLib.img.test(u)){n.push(t.handleImg(u))}else{n.push(t.handleParagraph(u))}break}}n=(s?s.join("")+"</div>":"")+n.join("");if(this.editor2Html){this.editor2Html.innerHTML=n}return n},handleTitle:function(e,t){var r=this;return e.replace(/(#{1,6})(.+)/,function(e,r,n){var i=r.length;if(t){t.push('<a class="mdeditor-toc-'+i+'" href="#'+n+'">'+n+"</a>")}return"<h"+i+' id="'+n+'" >'+n+"</h"+i+">"})},handleParagraph:function(e){return"<p>"+this.handleInlineSet(e)+"</p>"},handleInlineSet:function(e){e=this.replaceHtmlTag(e);e=this.handleInlineCode(e);e=this.handleLink(e);e=this.handleBold(e);return e},handleImg:function(e){return'<p class="mdeditor-img">'+e.replace(this.regLib.img,function(e,t,r){return'<img alt="'+t+'" src="'+r+'">'})+"</p>"},handleLink:function(e){var t=this;return e.replace(t.regLib.a,function(e,r,n){r=t.handleBold(r);return'<a href="'+n+'" target="'+t.options.aTarget+'">'+r+"</a>"})},handleBold:function(e){var t=this;return e.replace(t.regLib.b,function(e,t){return"<b>"+t+"</b>"})},handleInlineCode:function(e){var t=this;return e.replace(t.regLib.inlinecode,function(e,r){return'<span class="mdeditor-inline-code">'+t.replaceHtmlTag(r)+"</span>"})},handleUnorderedList:function(e){e=e.replace(/^[\.\*\-]\s*/,"");e=this.handleInlineSet(e);return"<li>"+e+"</li>"},handleOrderList:function(e){e=e.replace(/^\d+\.\s*/,"");e=this.handleInlineSet(e);return"<li>"+e+"</li>"},handleCodeType:function(e,t){switch(e){case"css":return t.replace(/([a-zA-Z-]+:)([^;]+)(;?)/g,'<span class="css-property-name">$1</span><span class="css-property-value">$2</span><span class="css-semicolon">$3</span>');default:return t}},replaceHtmlTag:function(e){return e.replace(/\</g,"&lt;").replace(/\>/,"&gt;")}};t.prototype.init.prototype=t.prototype;e.mdeditor=t})(window);