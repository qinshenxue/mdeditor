/* https://github.com/qinshenxue/mdeditor */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.mdeditor=e()}(this,function(){"use strict";var w={title:/^#{1,6}.+$/,ul:/^[\.\-\*]\s+.+$/,ol:/^\d+\.\s?.+$/,blockquote:/^!?>.+?$/,code:/^\`{3}.*$/,table:/^(\|[^|]+)+\|\s*$/,align:/^(\|\s*:?-+:?\s*)+\|\s*$/,hr:/^(\*|\_|\-){3,}$/,img:/\!\[(.*?)\]\((.*?)\)/g,a:/\[((?:[^\(\)\[\]]|\\\[|\\\]|\\\(|\\\))+)\]\((.+?)\)/g,b:/\*\*(.+?)\*\*/g,i:/\*(.+?)\*/g,inlineCode:/\`(.+?)\`/g};function b(t,e){for(var r=[],n=0,s=e.length;n<s;n++){var o=e[n];if(/^\s+/.test(o)){for(var i=[];n<e.length;n++){if(!/^\s+/.test(e[n])){n--;break}i.push(e[n].replace(/^\s+/,""))}r[r.length-1].children=a(i)}else r.push({tag:"li",md:e[n],children:[],html:y("ul"==t?e[n].replace(/^[\.\*\-]\s*/,""):e[n].replace(/^\d\.\s*/,""))})}return r}function y(t){return t=_(t),t=t.replace(w.img,'<img alt="$1" src="$2">'),t=t.replace(w.inlineCode,"<code>$1</code>"),t=t.replace(w.a,function(t,e,r){return'<a href="'+r+'" target="_blank">'+y(e.replace(/\\([\(\)\[\])])/g,"$1"))+"</a>"}),t=t.replace(w.b,"<b>$1</b>"),t=t.replace(w.i,"<i>$1</i>")}function _(t){return t.replace(/\</g,"&lt;").replace(/\>/g,"&gt;")}function k(t){for(var e=[],r=0;r<t.length;r++){var n=t[r];if(/^\s+/.test(n)){for(var s=[];r<t.length;r++){if(!/^\s+/.test(t[r])){r--;break}s.push(t[r].replace(/^\s+/,""))}e[e.length-1].children=a(s)}else e.push({tag:"p",md:n,children:[],html:y(n.replace(/^(!)?>/,""))})}return e}function x(t){for(var e=/[^|]+/g,r=t[1].match(e)||[],n=[],s=0,o=r.length;s<o;s++)/^\s*-+:\s*$/.test(r[s])?n.push("right"):/^\s*:-+:\s*$/.test(r[s])?n.push("center"):n.push("left");var i={tag:"tr",children:[]};function a(t){if(t<n.length&&"left"!==n[t])return{"text-align":n[t]}}for(var l=t[0].match(e)||[],c=l.length,h=0;h<c;h++)i.children.push({tag:"th",style:a(h),md:l[h],html:y(l[h].trim())});for(var u=[],d=2,f=t.length;d<f;d++){for(var p={tag:"tr",children:[]},g=c,m=t[d].match(e)||[];g--;){var v=m[g];p.children.unshift({tag:"td",style:a(g),md:v,html:v?y(v.trim()):""})}u.push(p)}return[i].concat(u)}function a(t){for(var e=[],r=t.length,n="",s=0;s<r;s++){var o=t[s];if(w.title.test(o)){var i=/^#{1,6}/,a=o.match(i);a&&e.push({tag:"h"+a[0].length,md:o,html:y(o.replace(i,"").replace(/^\s*/,""))})}else if(w.hr.test(o))e.push({tag:"hr",md:o});else if((n=!!w.ul.test(o)&&"ul")||(n=!!w.ol.test(o)&&"ol")){for(var l=[];s<r;s++){var c=t[s];if(!w[n].test(c)&&!/^\s+.+/.test(c)){s--;break}l.push(c)}e.push({tag:n,children:b(n,l),md:l.join("\n")})}else if(w.table.test(o)&&t[s+1]&&w.align.test(t[s+1])){var h=[o,t[s+1]];for(s+=2;s<r;s++){var u=t[s];if(!w.table.test(u)){s--;break}h.push(u)}e.push({tag:"table",children:x(h),md:h.join("\n")})}else if(w.blockquote.test(o)){var d=[o],f=0==o.indexOf("!")?"warning":"";for(s++;s<r;s++){var p=t[s];if(!w.blockquote.test(p)&&!/^\s+.+/.test(p)){s--;break}d.push(p)}e.push({tag:"blockquote",class:f,children:k(d),md:d.join("\n")})}else if(w.code.test(o)){var g=o.match(/[^`\s]+/);g=g?g[0]:"";var m="";for(s++;s<r;s++){var v=_(t[s]);if(w.code.test(v))break;m+=v,/^\n/.test(v)||(m+="\n")}e.push({tag:"pre",children:[{tag:"code",html:m}],attr:{"data-lang":g},class:g,md:o+"\n"+m+"```"})}else/^\n+/.test(o)||e.push({tag:"p",md:o,html:y(o)})}return e}function l(t){return a(t.match(/.+|^\n/gm)||[])}function t(t){return function t(e){for(var r=[],n=0,s=e.length;n<s;n++){var o=e[n];if("text"==o.tag)r.push(o.html),o.children&&r.push(t(o.children));else{if(r.push("<"+o.tag),o.class&&r.push(' class="'+o.class+'" '),o.style){for(var i in r.push(' style="'),o.style)r.push(i+":"+o.style[i]+";");r.push('" ')}if(o.attr)for(var a in o.attr)r.push(" "+a+'="'+o.attr[a]+'" ');r.push(">"),o.html&&r.push(o.html),o.children&&r.push(t(o.children)),r.push("</"+o.tag+">")}}return r.join("")}(l(t))}var e,r=Object.defineProperty;function c(t){this.editor=t,this.path=[],r(this,"selection",{get:function(){return window.getSelection()}}),r(this,"node",{get:function(){return this._inside()?this.selection.baseNode:null}}),r(this,"offset",{get:function(){return this.selection.baseOffset}})}function n(t,e){var r=document.querySelector(t);if(r){this.elm=r,this._rowNo=0,r.setAttribute("contenteditable","true");var n=[];if(e&&e.markdown&&(n=l(e.markdown)).length){for(var s="",o=0,i=n.length;o<i;o++){var a=n[o];s+='<div row="'+this._rowNo+++'" class="'+a.tag+'">'+(a.md||"")+"</div>"}r.innerHTML=s}else r.innerHTML='<div row="'+this._rowNo+++'"><br></div>';this._initEvent(),this.cursor=new c(r)}return this}return c.prototype._inside=function(){for(var t=this.selection.baseNode,e=[t];t&&!t.isEqualNode(this.editor);)t=t.parentNode,e.push(t);return this.path=e,!!t&&t.isEqualNode(this.editor)},c.prototype.closest=function(e){var r=null;return this._inside()&&this.path.some(function(t){if(t.matches&&t.matches(e))return r=t,!0}),r},c.prototype.closestRow=function(){return this.closest("[row]")},c.prototype.set=function(t,e){var r=t,n=t instanceof Text,s=window.getSelection(),o=document.createRange();void 0===e&&(e=n?t.nodeValue.length:r.textContent.length),o.setStart(n?t:r.childNodes[0],e),o.collapse(!0),s.removeAllRanges(),s.addRange(o)},n.prototype._initEvent=function(){var r=this,t=this.elm.addEventListener;function e(){if(r._lastRow){var t=l(r._lastRow.innerText);if(t.length){var e=t[0];r._lastRow.setAttribute("class",e.tag),e.attr&&Object.keys(e.attr).forEach(function(t){e.attr&&e.attr[t]&&r._lastRow.setAttribute(t,e.attr[t])})}}}t("paste",function(t){t.preventDefault();var e=t.clipboardData.getData("text/plain"),r=document.createElement("div");r.innerText=e,document.execCommand("insertHTML",!1,r.innerHTML.replace(/\s/g,"&nbsp;"))}),t("keydown",function(t){if(13!==t.keyCode||t.shiftKey)8!==t.keyCode||r.elm.textContent||t.preventDefault();else{t.preventDefault();var e=r.cursor.closestRow();e.textContent&&r.cursor.node===e.childNodes[e.childNodes.length-1]&&r.cursor.node.length===r.cursor.offset&&document.execCommand("insertHTML",!1,"<div row='"+r._rowNo+++"'><br></div>")}}),t("blur",e),this._lastRow=null,document.addEventListener("selectionchange",function(){if(window.getSelection().isCollapsed){var t=r.cursor.closestRow();t?r._lastRow||t.textContent?r._lastRow&&r._lastRow.getAttribute("row")!==t.getAttribute("row")&&e():t.setAttribute("class",""):e(),r._lastRow=t}else r._lastRow=null})},(e=n).prototype.getMarkdown=function(){return this.elm.innerText},e.prototype.getHtml=function(){return t(this.getMarkdown())},e.prototype.setMarkdown=function(t){for(var e=l(t),r="",n=0,s=e.length;n<s;n++){var o=e[n];r+='<div row="'+this._rowNo+++'" class="'+o.tag+'">'+(o.md||"").replace(/\n/g,"<br>")+"</div>"}this.elm.innerHTML=r},e.prototype.insertMarkdown=function(t){document.execCommand("insertText",!1,t)},n});
