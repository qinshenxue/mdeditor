!function(e){var t=function(e){return new t.prototype.init(e)};t.version="1.2.0",t.prototype={constructor:t,init:function(e){var t=this,n={id:"",placeholder:"",name:"",aTarget:"_blank"};if(e&&e.id){t.copy(n,e);var r=this.getDom(e.id),i='<textarea id="mdeditor" class="mdeditor" name="{{name}}" placeholder="{{placeholder}}"></textarea><div id="mdeditor-html" class="mdeditor-html"></div>';i=t.formatString(i,n),r.innerHTML=i;var l=this.getDom("mdeditor"),a=this.getDom("mdeditor-html");l.addEventListener("input",function(){var e=this.value;t.markdownToHtml(e)});var s="";l.addEventListener("scroll",function(){"editor"==s&&(a.scrollTop=l.scrollTop/(l.scrollHeight-l.clientHeight)*(a.scrollHeight-a.clientHeight))}),a.addEventListener("scroll",function(){"editor2Html"==s&&(l.scrollTop=a.scrollTop/(a.scrollHeight-a.clientHeight)*(l.scrollHeight-l.clientHeight))}),l.addEventListener("mousemove",function(e){s="editor"}),a.addEventListener("mousemove",function(){s="editor2Html"}),t.editor=l,t.editor2Html=a}return t.options=n,t},regLib:{code:/^\`{3}.*$/,ul:/^[\.\-\*]\s+.+$/,ol:/^\d+\.\s?.+$/,toc:/^\s*\[TOC\]\s*$/,img:/\!\[(.*?)\]\((.*?)\)/g,title:/^#{1,6}.+$/,a:/\[(.*?)\]\((.*?)\)/g,b:/\*\*(.+?)\*\*/g,i:/\*(.+?)\*/g,inline_code:/\`(.+?)\`/g,blockquote:/^>(.+?)$/,iframe:/^\$\[(.*?)\]\((.*?)\)$/,table:/^(\|[^|]+)+\|$/,table_td_align:/^(\|\s*:?-+:?\s*)+\|$/,table_td_align_left:/^\s*:-+\s*$/,table_td_align_center:/^\s*:-+:\s*$/,table_td_align_right:/^\s*-+:\s*$/},formatString:function(e,t){return e.replace(/{{(\w+)}}/g,function(e,n){return t[n]})},copy:function(e,t){for(var n in t)e[n]=t[n];return e},getDom:function(e){return document.getElementById(e)},getMarkdown:function(){return this.editor?this.editor.value:null},setMarkdown:function(e){return this.editor&&(this.editor.value=e),this.markdownToHtml(e)},getHTML:function(){return this.editor2Html?this.editor2Html.innerHTML:""},markdownToHtml:function(e){var t=this,n=e.match(/.+/gm)||[],r=[],i=n.length,l=0,a=null;i&&t.regLib.toc.test(n[0])&&(l=1,a=['<div class="mdeditor-toc">']);for(var s=l;i>s;s++){var o=n[s];if(t.regLib.title.test(o))r.push(t.handleTitle(o,a));else if(t.regLib.ul.test(o)){var h=t.handleUl(n,s);r=r.concat(h.html),s=h.index}else if(t.regLib.ol.test(o)){var c=t.handleOl(n,s);r=r.concat(c.html),s=c.index}else if(t.regLib.table.test(o)){var d=t.handleTable(n,s);r=r.concat(d.html),s=d.index}else if(t.regLib.blockquote.test(o)){var u=t.handleBlockquote(n,s);r=r.concat(u.html),s=u.index}else if(t.regLib.code.test(o)){var g=t.handlePre(n,s);r=r.concat(g.html),s=g.index}else t.regLib.iframe.test(o)?r.push(t.handleIframe(o)):(o=t.replaceHtmlTag(o),r.push(t.handleParagraph(o)))}return r=(a?a.join("")+"</div>":"")+r.join(""),this.editor2Html&&(this.editor2Html.innerHTML=r),r},handleBlockquote:function(e,t){var n=[],r=t;if(this.regLib.blockquote.test(e[t])){for(n.push('<blockquote class="mdeditor-blockquote">');r<e.length&&this.regLib.blockquote.test(e[r]);r++){var i=this.replaceHtmlTag(e[r]).replace(/>/,"");if(this.regLib.ul.test(i)){var l=this.handleUl(e,r,/>/);n=n.concat(l.html),r=l.index}else if(this.regLib.ol.test(i)){var a=this.handleOl(e,r,/>/);n=n.concat(a.html),r=a.index}else n.push(this.handleParagraph(i))}n.push("</blockquote>")}return{html:n,index:r-1}},handleUl:function(e,t,n){var r=[],i=t;if(this.regLib.ul.test(n?e[t].replace(n,""):e[t])){for(r.push('<ul class="mdeditor-ul">');i<e.length;i++){var l=this.replaceHtmlTag(e[i]);if(n&&(l=l.replace(n,"")),!this.regLib.ul.test(l))break;l=l.replace(/^[\.\*\-]\s*/,""),r.push("<li>"+this.handleInlineSet(l)+"</li>")}r.push("</ul>")}return{html:r,index:i-1}},handleOl:function(e,t,n){var r=[],i=t;if(this.regLib.ol.test(n?e[t].replace(n,""):e[t])){for(r.push('<ol class="mdeditor-ol">');i<e.length;i++){var l=this.replaceHtmlTag(e[i]);if(n&&(l=l.replace(n,"")),!this.regLib.ol.test(l))break;l=l.replace(/^\d+\.\s*/,""),r.push("<li>"+this.handleInlineSet(l)+"</li>")}r.push("</ol>")}return{html:r,index:i-1}},handlePre:function(e,t){var n=[],r=t,i=e[t];if(this.regLib.code.test(i)){var l=i.replace(/[`\s]/g,"");for(n.push('<pre class="mdeditor-code mdeditor-code-'+l.toLowerCase()+'">'),n.push("<ol>"),r++;r<e.length;r++){var a=this.replaceHtmlTag(e[r]);if(this.regLib.code.test(a))break;n.push("<li><div>"+this.handleCodeType(l,a)+"</div></li>")}n.push("</ol>"),n.push("</pre>")}return{html:n,index:r}},handleTable:function(e,t){var n=[],r=t,i=e[t],l=e[t+1];if(l&&this.regLib.table.test(i)&&this.regLib.table_td_align.test(l)){n.push('<table class="mdeditor-table">'),n.push("<tr>");for(var a=i.match(/[^|]+/g),s=this.handleTdAlign(l),o=0,h=a.length;h>o;o++)n.push('<th style="text-align:'+s[o]+'">'+a[o]+"</th>");for(n.push("</tr>"),r+=2;r<e.length;r++){var c=e[r];if(!this.regLib.table.test(c))break;n.push(this.handleTr(c,s))}n.push("</table>")}return{html:n,index:r-1}},handleTr:function(e,t){for(var n=e.match(/[^|]+/g),r="<tr>",i=0,l=n.length;l>i;i++)r+='<td style="text-align:'+t[i]+'">'+this.handleInlineSet(n[i])+"</td>";return r+="</tr>"},handleTdAlign:function(e){for(var t=e.match(/[^|]+/g),n=[],r=0,i=t.length;i>r;r++)this.regLib.table_td_align_right.test(t[r])?n.push("right"):this.regLib.table_td_align_center.test(t[r])?n.push("center"):n.push("left");return n},handleTitle:function(e,t){return e.replace(/(#{1,6})(.+)/,function(e,n,r){var i=n.length;return t&&t.push('<a class="mdeditor-toc-'+i+'" href="#'+r+'">'+r+"</a>"),"<h"+i+' id="'+r+'" >'+r+"</h"+i+">"})},handleParagraph:function(e){return"<p>"+this.handleInlineSet(e)+"</p>"},handleInlineSet:function(e){return e=this.handleImg(e),e=this.handleInlineCode(e),e=this.handleLink(e),e=this.handleBold(e),e=this.handelItalic(e)},handleImg:function(e){return e.replace(this.regLib.img,function(e,t,n){return'<img class="mdeditor-img" alt="'+t+'" src="'+n+'">'})},handleIframe:function(e){return e.replace(this.regLib.iframe,function(e,t,n){var r="";return""==t||isNaN(t)||(r='style="height:'+t+'px"'),'<iframe class="mdeditor-iframe" src="'+n+'" '+r+"></iframe>"})},handleLink:function(e){var t=this;return e.replace(t.regLib.a,function(e,n,r){return n=t.handleBold(n),'<a href="'+r+'" target="'+t.options.aTarget+'">'+n+"</a>"})},handleBold:function(e){var t=this;return e.replace(t.regLib.b,function(e,t){return"<b>"+t+"</b>"})},handelItalic:function(e){var t=this;return e.replace(t.regLib.i,function(e,t){return"<i>"+t+"</i>"})},handleInlineCode:function(e){var t=this;return e.replace(t.regLib.inline_code,function(e,t){return'<span class="mdeditor-inline-code">'+t+"</span>"})},handleCodeType:function(e,t){switch(e){case"javascript":return this.highlightJs(t);case"css":return t.replace(/([a-zA-Z-]+:)([^;\{]+)(;)/g,'<span class="css-property-name">$1</span><span class="css-property-value">$2</span><span class="css-semicolon">$3</span>');case"xml":return t.replace(/(&lt;\/?)(\w+)(.*?)(&gt;)/g,'<span class="xml-lt">$1</span><span class="xml-tag-name">$2</span><span class="xml-tag-attr">$3</span><span class="xml-gt">$4</span>');default:return t}},highlightJs:function(e){var t=["break","case","catch","continue","default","delete","do","else","finally","for","function","if","in","instanceof","new","return","switch","this","throw","try","typeof","var","void","while","with"],n=new RegExp("\\b("+t.join("|")+")\\b","g");return e.replace(/('|").*?('|")/g,function(e){return'<span class="js-string">'+e+"</span>"}).replace(n,function(e){return'<span class="js-keyword">'+e+"</span>"}).replace(/\/\/.+$/,function(e){return'<span class="js-line-comment">'+e+"</span>"})},replaceHtmlTag:function(e){return this.regLib.blockquote.test(e)?">"+e.substr(1).replace(/\</g,"&lt;").replace(/\>/g,"&gt;"):e.replace(/\</g,"&lt;").replace(/\>/g,"&gt;")}},t.prototype.init.prototype=t.prototype,e.mdeditor=t}(window);