!function(t){var e=function(t){return new e.prototype.init(t)};e.version="1.2.0",e.getType=function(t){return Object.prototype.toString.call(t).match(/\[object\s(\w+)\]/)[1].toLowerCase()},e.addGrammar=function(t){return t in e||(e.prototype.grammar=[]),"array"==this.getType(t)?e.prototype.grammar=e.prototype.grammar.concat(t):e.prototype.grammar.push(t),e},e.prototype={constructor:e,init:function(t){var e=this,r={id:"",placeholder:"",name:"",aTarget:"_blank"};if(t&&t.id){e.copy(r,t);var i=this.getDom("#"+t.id),n='<textarea class="mdeditor" name="{{name}}" placeholder="{{placeholder}}"></textarea><div class="mdeditor-html"></div>';n=e.formatString(n,r),i.innerHTML=n;var a=this.getDom("#"+r.id+" .mdeditor"),l=this.getDom("#"+r.id+" .mdeditor-html");void 0===a.oninput?a.onkeyup=function(){e.markdownToHtml(this.value)}:a.oninput=function(){e.markdownToHtml(this.value)};var s="";a.onscroll=function(){"editor"==s&&(l.scrollTop=a.scrollTop/(a.scrollHeight-a.clientHeight)*(l.scrollHeight-l.clientHeight))},l.onscroll=function(){"editor2Html"==s&&(a.scrollTop=l.scrollTop/(l.scrollHeight-l.clientHeight)*(a.scrollHeight-a.clientHeight))},a.onmousemove=function(){s="editor"},l.onmousemove=function(){s="editor2Html"},e.editor=a,e.editor2Html=l}return e.options=r,e},regLib:{code:/^\`{3}.*$/,ul:/^[\.\-\*]\s+.+$/,ol:/^\d+\.\s?.+$/,toc:/^\s*\[TOC\]\s*$/,img:/\!\[(.*?)\]\((.*?)\)/g,title:/^#{1,6}.+$/,a:/\[(.*?)\]\((.*?)\)/g,b:/\*\*(.+?)\*\*/g,i:/\*(.+?)\*/g,inline_code:/\`(.+?)\`/g,blockquote:/^>(.+?)$/,table:/^(\|[^|]+)+\|\s*$/,table_td_align:/^(\|\s*:?-+:?\s*)+\|\s*$/,table_td_align_left:/^\s*:-+\s*$/,table_td_align_center:/^\s*:-+:\s*$/,table_td_align_right:/^\s*-+:\s*$/},formatString:function(t,e){return t.replace(/{{(\w+)}}/g,function(t,r){return e[r]})},copy:function(t,e){for(var r in e)t[r]=e[r];return t},getDom:function(t){return document.querySelector(t)},getMarkdown:function(){return this.editor?this.editor.value:null},setMarkdown:function(t){return this.editor&&(this.editor.value=t),this.markdownToHtml(t)},getHTML:function(){return this.editor2Html?this.editor2Html.innerHTML:""},markdownToHtml:function(t){var e=t.match(/.+/gm)||[],r=[],i=e.length,n=0,a=[],l=!1;if(i>0){this.regLib.toc.test(e[0])&&(n=1,l=!0,a.push('<div class="mdeditor-toc">'));for(var s=n;i>s;s++){var o=e[s];if(this.regLib.title.test(o))r.push(this.handleTitle(o,a));else if(this.regLib.ul.test(o)){var h=this.handleUl(e,s);r=r.concat(h.html),s=h.index}else if(this.regLib.ol.test(o)){var c=this.handleOl(e,s);r=r.concat(c.html),s=c.index}else if(this.regLib.table.test(o)){var d=this.handleTable(e,s);r=r.concat(d.html),s=d.index}else if(this.regLib.blockquote.test(o)){var u=this.handleBlockquote(e,s);r=r.concat(u.html),s=u.index}else if(this.regLib.code.test(o)){var p=this.handlePre(e,s);r=r.concat(p.html),s=p.index}else{var g=this.matchGrammar(o);if(g){var m=g.handle.call(this,e,s,g);r=r.concat(m.html),s=m.index}else r.push(this.handleParagraph(o))}}}return r=(l?a.join("")+"</div>":"")+r.join(""),this.toc=a,this.editor2Html&&(this.editor2Html.innerHTML=r),r},matchGrammar:function(t){if(this.grammar&&this.grammar.length>0)for(var e=0,r=this.grammar.length;r>e;e++)if(this.grammar[e].reg.test(t))return this.grammar[e];return!1},handleBlockquote:function(t,e){var r=[],i=e;if(this.regLib.blockquote.test(t[e])){for(r.push('<blockquote class="mdeditor-blockquote">');i<t.length&&this.regLib.blockquote.test(t[i]);i++){var n=t[i].replace(/>/,"");if(this.regLib.ul.test(n)){var a=this.handleUl(t,i,/>/);r=r.concat(a.html),i=a.index}else if(this.regLib.ol.test(n)){var l=this.handleOl(t,i,/>/);r=r.concat(l.html),i=l.index}else r.push(this.handleParagraph(n))}r.push("</blockquote>")}return{html:r,index:i-1}},handleUl:function(t,e,r){var i=[],n=e;if(this.regLib.ul.test(r?t[e].replace(r,""):t[e])){for(i.push('<ul class="mdeditor-ul">');n<t.length;n++){var a=t[n];if(r&&(a=a.replace(r,"")),!this.regLib.ul.test(a))break;a=this.replaceHtmlTag(a),a=a.replace(/^[\.\*\-]\s*/,""),i.push("<li>"+this.handleInlineSet(a)+"</li>")}i.push("</ul>")}return{html:i,index:n-1}},handleOl:function(t,e,r){var i=[],n=e;if(this.regLib.ol.test(r?t[e].replace(r,""):t[e])){for(i.push('<ol class="mdeditor-ol">');n<t.length;n++){var a=t[n];if(r&&(a=a.replace(r,"")),!this.regLib.ol.test(a))break;a=this.replaceHtmlTag(a),a=a.replace(/^\d+\.\s*/,""),i.push("<li>"+this.handleInlineSet(a)+"</li>")}i.push("</ol>")}return{html:i,index:n-1}},handlePre:function(t,e){var r=[],i=e,n=t[e];if(this.regLib.code.test(n)){var a=n.replace(/[`\s]/g,"");for(r.push('<pre class="mdeditor-code mdeditor-code-'+a.toLowerCase()+'">'),r.push("<ol>"),i++;i<t.length;i++){var l=t[i];if(this.regLib.code.test(l))break;l=this.replaceHtmlTag(l),r.push("<li><div>"+this.handleCodeType(a,l)+"</div></li>")}r.push("</ol>"),r.push("</pre>")}return{html:r,index:i}},handleTable:function(t,e){var r=[],i=e,n=t[e],a=t[e+1];if(a&&this.regLib.table.test(n)&&this.regLib.table_td_align.test(a)){r.push('<table class="mdeditor-table">'),r.push("<tr>");for(var l=n.match(/[^|]+/g),s=this.handleTdAlign(a),o=0,h=l.length;h>o;o++)r.push('<th style="text-align:'+s[o]+'">'+this.replaceHtmlTag(l[o])+"</th>");for(r.push("</tr>"),i+=2;i<t.length;i++){var c=t[i];if(!this.regLib.table.test(c))break;c=this.replaceHtmlTag(c),r.push(this.handleTr(c,s))}r.push("</table>")}return{html:r,index:i-1}},handleTr:function(t,e){for(var r=t.match(/[^|]+/g),i="<tr>",n=0,a=r.length;a>n;n++)i+='<td style="text-align:'+e[n]+'">'+this.handleInlineSet(r[n])+"</td>";return i+="</tr>"},handleTdAlign:function(t){for(var e=t.match(/[^|]+/g),r=[],i=0,n=e.length;n>i;i++)this.regLib.table_td_align_right.test(e[i])?r.push("right"):this.regLib.table_td_align_center.test(e[i])?r.push("center"):r.push("left");return r},handleTitle:function(t,e){var r=this;return t.replace(/(#{1,6})(.+)/,function(t,i,n){var a=i.length;return n=r.replaceHtmlTag(n),e.push('<a class="mdeditor-toc-'+a+'" href="#'+n+'">'+n+"</a>"),"<h"+a+' id="'+n+'" >'+n+"</h"+a+">"})},handleParagraph:function(t){return t=this.replaceHtmlTag(t),"<p>"+this.handleInlineSet(t)+"</p>"},handleInlineSet:function(t){return t=this.handleImg(t),t=this.handleInlineCode(t),t=this.handleLink(t),t=this.handleBold(t),t=this.handelItalic(t)},handleImg:function(t){return t.replace(this.regLib.img,function(t,e,r){return'<img class="mdeditor-img" alt="'+e+'" src="'+r+'">'})},handleLink:function(t){var e=this;return t.replace(e.regLib.a,function(t,r,i){return r=e.handleBold(r),'<a href="'+i+'" target="'+e.options.aTarget+'">'+r+"</a>"})},handleBold:function(t){var e=this;return t.replace(e.regLib.b,function(t,e){return"<b>"+e+"</b>"})},handelItalic:function(t){var e=this;return t.replace(e.regLib.i,function(t,e){return"<i>"+e+"</i>"})},handleInlineCode:function(t){var e=this;return t.replace(e.regLib.inline_code,function(t,e){return'<span class="mdeditor-inline-code">'+e+"</span>"})},handleCodeType:function(t,e){switch(t){case"javascript":return this.highlightJs(e);case"css":return e.replace(/([a-zA-Z-]+:)([^;\{]+)(;)/g,'<span class="css-property-name">$1</span><span class="css-property-value">$2</span><span class="css-semicolon">$3</span>');case"xml":return e.replace(/(&lt;\/?)(\w+)(.*?)(&gt;)/g,'<span class="xml-lt">$1</span><span class="xml-tag-name">$2</span><span class="xml-tag-attr">$3</span><span class="xml-gt">$4</span>');default:return e}},highlightJs:function(t){var e=["break","case","catch","continue","default","delete","do","else","finally","for","function","if","in","instanceof","new","return","switch","this","throw","try","typeof","var","void","while","with"],r=new RegExp("\\b("+e.join("|")+")\\b","g");return t.replace(/('|").*?('|")/g,function(t){return'<span class="js-string">'+t+"</span>"}).replace(r,function(t){return'<span class="js-keyword">'+t+"</span>"}).replace(/\/\/.+$/,function(t){return'<span class="js-line-comment">'+t+"</span>"})},replaceHtmlTag:function(t){return t.replace(/\</g,"&lt;").replace(/\>/g,"&gt;")}},e.prototype.init.prototype=e.prototype,t.mdeditor=e}(window);