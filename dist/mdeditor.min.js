!function(e){var t=function(e){return new t.prototype.init(e)};t.prototype={init:function(e){var t=this,r={id:"",placeholder:"",name:"",aTarget:"_blank"};if(e&&e.id){t.copy(r,e);var n=this.getDom(e.id),i='<textarea id="mdeditor" class="mdeditor" name="{{name}}" placeholder="{{placeholder}}"></textarea><div id="mdeditor-html" class="mdeditor-html"></div>';i=t.formatString(i,r),n.innerHTML=i;var l=this.getDom("mdeditor"),a=this.getDom("mdeditor-html");l.addEventListener("input",function(){var e=this.value;t.markdownToHtml(e),l.scrollTop=l.scrollHeight-a.clientHeight,a.scrollTop=a.scrollHeight-a.clientHeight});var s="";l.addEventListener("scroll",function(){"editor"==s&&(a.scrollTop=l.scrollTop/(l.scrollHeight-l.clientHeight)*(a.scrollHeight-a.clientHeight))}),a.addEventListener("scroll",function(){"editor2Html"==s&&(l.scrollTop=a.scrollTop/(a.scrollHeight-a.clientHeight)*(l.scrollHeight-l.clientHeight))}),l.addEventListener("mousemove",function(e){s="editor"}),a.addEventListener("mousemove",function(){s="editor2Html"}),t.editor=l,t.editor2Html=a}return t.options=r,t},regLib:{code:/^\`{3}.*$/,ul:/^[\.\-\*]\s?.+$/,ol:/^\d+\.\s?.+$/,toc:/^\s*\[TOC\]\s*$/,img:/\!\[(.*?)\]\((.*?)\)/g,title:/^#{1,6}.+$/,a:/\[(.*?)\]\((.*?)\)/g,b:/\*\*(.+?)\*\*/g,inline_code:/\`(.+?)\`/g,table:/^(\|[^|]+)+\|$/,table_td_align:/^(\|\s*:?-+:?\s*)+\|$/,table_td_align_left:/^\s*:-+\s*$/,table_td_align_center:/^\s*:-+:\s*$/,table_td_align_right:/^\s*-+:\s*$/},formatString:function(e,t){return e.replace(/{{(\w+)}}/g,function(e,r){return t[r]})},copy:function(e,t){for(var r in t)e[r]=t[r];return e},getDom:function(e){return document.getElementById(e)},getMarkdown:function(){return this.editor?this.editor.value:null},setMarkdown:function(e){return this.editor&&(this.editor.value=e),this.markdownToHtml(e)},getHTML:function(){return this.editor2Html?this.editor2Html.innerHTML:""},markdownToHtml:function(e){var t=this,r=e.match(/.+/gm)||[],n=[],i="",l="",a=r.length,s=0,o=null,d=[];a&&t.regLib.toc.test(r[0])&&(s=1,o=['<div class="mdeditor-toc">']);for(var h=s;a>h;h++){var c=r[h];switch(c=t.replaceHtmlTag(c),i){case"ol":t.regLib.ol.test(c)?(n.push(t.handleOrderList(c)),h==a-1&&n.push("</ol>")):(h--,i="",n.push("</ol>"));break;case"ul":t.regLib.ul.test(c)?(n.push(t.handleUnorderedList(c)),h==a-1&&n.push("</ul>")):(h--,i="",n.push("</ul>"));break;case"code":t.regLib.code.test(c)?(i="",n.push("</code>"),n.push("</pre>")):n.push("<li><div>"+t.handleCodeType(l,c)+"</div></li>");break;case"table":t.regLib.table.test(c)?(n.push(t.handleTr(c,d)),h==a-1&&n.push("</table>")):(h--,i="",n.push("</table>"));break;default:if(t.regLib.title.test(c))n.push(t.handleTitle(c,o));else if(t.regLib.ol.test(c))h--,i="ol",n.push('<ol  class="mdeditor-ol">');else if(t.regLib.ul.test(c))h--,i="ul",n.push('<ul  class="mdeditor-ul">');else if(t.regLib.code.test(c))i="code",l=c.replace(/[`\s]/g,""),n.push('<pre class="mdeditor-code mdeditor-code-'+l.toLowerCase()+'">'),n.push("<ol>");else if(t.regLib.table.test(c))if(h!=a-1&&t.regLib.table_td_align.test(r[h+1])){i="table",n.push('<table class="mdeditor-table"><tr>');var u=c.match(/[^|]+/g);d=t.handleTdAlign(r[h+1]);for(var p=0,g=u.length;g>p;p++)n.push('<th style="text-align:'+d[p]+'">'+u[p]+"</th>");n.push("</tr>"),h++,h==a-1&&n.push("</table>")}else n.push(t.handleParagraph(c));else t.regLib.img.test(c)?n.push(t.handleImg(c)):n.push(t.handleParagraph(c))}}return n=(o?o.join("")+"</div>":"")+n.join(""),this.editor2Html&&(this.editor2Html.innerHTML=n),n},handleTr:function(e,t){for(var r=e.match(/[^|]+/g),n="<tr>",i=0,l=r.length;l>i;i++)n+='<td style="text-align:'+t[i]+'">'+this.handleInlineSet(r[i])+"</td>";return n+="</tr>"},handleTdAlign:function(e){for(var t=e.match(/[^|]+/g),r=[],n=0,i=t.length;i>n;n++)this.regLib.table_td_align_right.test(t[n])?r.push("right"):this.regLib.table_td_align_center.test(t[n])?r.push("center"):r.push("left");return r},handleTitle:function(e,t){return e.replace(/(#{1,6})(.+)/,function(e,r,n){var i=r.length;return t&&t.push('<a class="mdeditor-toc-'+i+'" href="#'+n+'">'+n+"</a>"),"<h"+i+' id="'+n+'" >'+n+"</h"+i+">"})},handleParagraph:function(e){return"<p>"+this.handleInlineSet(e)+"</p>"},handleInlineSet:function(e){return e=this.handleInlineCode(e),e=this.handleLink(e),e=this.handleBold(e)},handleImg:function(e){return'<p class="mdeditor-img">'+e.replace(this.regLib.img,function(e,t,r){return'<img alt="'+t+'" src="'+r+'">'})+"</p>"},handleLink:function(e){var t=this;return e.replace(t.regLib.a,function(e,r,n){return r=t.handleBold(r),'<a href="'+n+'" target="'+t.options.aTarget+'">'+r+"</a>"})},handleBold:function(e){var t=this;return e.replace(t.regLib.b,function(e,t){return"<b>"+t+"</b>"})},handleInlineCode:function(e){var t=this;return e.replace(t.regLib.inline_code,function(e,t){return'<span class="mdeditor-inline-code">'+t+"</span>"})},handleUnorderedList:function(e){return e=e.replace(/^[\.\*\-]\s*/,""),e=this.handleInlineSet(e),"<li>"+e+"</li>"},handleOrderList:function(e){return e=e.replace(/^\d+\.\s*/,""),e=this.handleInlineSet(e),"<li>"+e+"</li>"},handleCodeType:function(e,t){switch(e){case"css":return t.replace(/([a-zA-Z-]+:)([^;]+)(;?)/g,'<span class="css-property-name">$1</span><span class="css-property-value">$2</span><span class="css-semicolon">$3</span>');default:return t}},replaceHtmlTag:function(e){return e.replace(/\</g,"&lt;").replace(/\>/,"&gt;")}},t.prototype.init.prototype=t.prototype,e.mdeditor=t}(window);