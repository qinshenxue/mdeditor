!function(t){var e=function(t){return new e.prototype.init(t)};e.version="1.4.1",e.addGrammar=function(t){return"[object Array]"=={}.toString.call(t)?e.prototype.grammars=e.prototype.grammars.concat(t):e.prototype.grammars.push(t),e},e.prototype={constructor:e,grammars:[],init:function(t){var e=this,r={id:"",placeholder:"",name:"",aTarget:"_blank"};if(t&&t.id){e.copy(r,t);var i=this.getDom("#"+t.id),n='<textarea class="mdeditor" name="{{name}}" placeholder="{{placeholder}}"></textarea><div class="mdeditor-html"></div>';n=e.formatString(n,r),i.innerHTML=n;var l=this.getDom("#"+r.id+" .mdeditor"),a=this.getDom("#"+r.id+" .mdeditor-html");void 0===l.oninput?l.onkeyup=function(){e.markdownToHtml(this.value)}:l.oninput=function(){e.markdownToHtml(this.value)};var s="";l.onscroll=function(){"editor"==s&&(a.scrollTop=l.scrollTop/(l.scrollHeight-l.clientHeight)*(a.scrollHeight-a.clientHeight))},a.onscroll=function(){"editor2Html"==s&&(l.scrollTop=a.scrollTop/(a.scrollHeight-a.clientHeight)*(l.scrollHeight-l.clientHeight))},l.onmousemove=function(){s="editor"},a.onmousemove=function(){s="editor2Html"},e.editor=l,e.editor2Html=a}return e.options=r,e},regLib:{code:/^\`{3}.*$/,ul:/^[\.\-\*]\s+.+$/,ol:/^\d+\.\s?.+$/,toc:/^\s*\[TOC\]\s*$/,img:/\!\[(.*?)\]\((.*?)\)/g,title:/^#{1,6}.+$/,a:/\[(([^(\(\)\[\])]|\\\[|\\\]|\\\(|\\\))+?)\]\((.+?)\)/g,b:/\*\*(.+?)\*\*/g,i:/\*(.+?)\*/g,inline_code:/\`(.+?)\`/g,blockquote:/^>(.+?)$/,hr:/^(\*\s*){3,}|(-\s*){3,}|(_\s*){3,}$/,table:/^(\|[^|]+)+\|\s*$/,table_td_align:/^(\|\s*:?-+:?\s*)+\|\s*$/,table_td_align_left:/^\s*:-+\s*$/,table_td_align_center:/^\s*:-+:\s*$/,table_td_align_right:/^\s*-+:\s*$/},formatString:function(t,e){return t.replace(/{{(\w+)}}/g,function(t,r){return e[r]})},copy:function(t,e){for(var r in e)t[r]=e[r];return t},getDom:function(t){return document.querySelector(t)},getMarkdown:function(){return this.editor?this.editor.value:null},setMarkdown:function(t){return this.editor&&(this.editor.value=t),this.markdownToHtml(t)},getHTML:function(){return this.editor2Html?this.editor2Html.innerHTML:""},markdownToHtml:function(t){var e=t.match(/.+/gm)||[],r=[],i=e.length,n=0,l=[],a=!1;if(i>0){this.regLib.toc.test(e[0])&&(n=1,a=!0,l.push('<div class="mdeditor-toc">'));for(var s=n;s<i;s++){var o=e[s];if(this.regLib.title.test(o))r.push(this.handleTitle(o,l));else if(this.regLib.hr.test(o))r.push("<hr>");else if(this.regLib.ul.test(o)){var h=this.handleUl(e,s);r=r.concat(h.html),s=h.index}else if(this.regLib.ol.test(o)){var c=this.handleOl(e,s);r=r.concat(c.html),s=c.index}else if(this.regLib.table.test(o)){var d=this.handleTable(e,s);r=r.concat(d.html),s=d.index}else if(this.regLib.blockquote.test(o)){var u=this.handleBlockquote(e,s);r=r.concat(u.html),s=u.index}else if(this.regLib.code.test(o)){var g=this.handlePre(e,s);r=r.concat(g.html),s=g.index}else{var m=this.matchGrammar(o);if(m){var p=m.handle.call(this,e,s,m);r=r.concat(p.html),s=p.index}else r.push(this.handleParagraph(o))}}}return r=(a?l.join("")+"</div>":"")+r.join(""),this.toc=l,this.editor2Html&&(this.editor2Html.innerHTML=r),r},matchGrammar:function(t){if(this.grammars.length>0)for(var e=0,r=this.grammars.length;e<r;e++)if(this.grammars[e].reg.test(t))return this.grammars[e];return!1},handleBlockquote:function(t,e){var r=[],i=e;if(this.regLib.blockquote.test(t[e])){for(r.push('<blockquote class="mdeditor-blockquote">');i<t.length&&this.regLib.blockquote.test(t[i]);i++){var n=t[i].replace(/>/,"");if(this.regLib.ul.test(n)){var l=this.handleUl(t,i,/>/);r=r.concat(l.html),i=l.index}else if(this.regLib.ol.test(n)){var a=this.handleOl(t,i,/>/);r=r.concat(a.html),i=a.index}else r.push(this.handleParagraph(n))}r.push("</blockquote>")}return{html:r,index:i-1}},handleUl:function(t,e,r){var i=[],n=e;if(this.regLib.ul.test(r?t[e].replace(r,""):t[e])){for(i.push('<ul class="mdeditor-ul">');n<t.length;n++){var l=t[n];if(r&&(l=l.replace(r,"")),!this.regLib.ul.test(l))break;l=this.replaceHtmlTag(l),l=l.replace(/^[\.\*\-]\s*/,""),i.push("<li>"+this.handleInlineSet(l)+"</li>")}i.push("</ul>")}return{html:i,index:n-1}},handleOl:function(t,e,r){var i=[],n=e;if(this.regLib.ol.test(r?t[e].replace(r,""):t[e])){for(i.push('<ol class="mdeditor-ol">');n<t.length;n++){var l=t[n];if(r&&(l=l.replace(r,"")),!this.regLib.ol.test(l))break;l=this.replaceHtmlTag(l),l=l.replace(/^\d+\.\s*/,""),i.push("<li>"+this.handleInlineSet(l)+"</li>")}i.push("</ol>")}return{html:i,index:n-1}},handlePre:function(t,e){var r=[],i=e,n=t[e];if(this.regLib.code.test(n)){var l=n.replace(/[`\s]/g,"");for(r.push('<pre class="mdeditor-code">'),r.push('<code class="'+l.toLowerCase()+'">'),i++;i<t.length;i++){var a=t[i];if(this.regLib.code.test(a))break;a=this.replaceHtmlTag(a),r.push(a+"\n")}r.push("</code>"),r.push("</pre>")}return{html:r,index:i}},handleTable:function(t,e){var r=[],i=e,n=t[e],l=t[e+1];if(l&&this.regLib.table.test(n)&&this.regLib.table_td_align.test(l)){r.push('<table class="mdeditor-table">'),r.push("<tr>");for(var a=n.match(/[^|]+/g),s=this.handleTdAlign(l),o=0,h=a.length;o<h;o++)r.push('<th style="text-align:'+s[o]+'">'+this.replaceHtmlTag(a[o])+"</th>");for(r.push("</tr>"),i+=2;i<t.length;i++){var c=t[i];if(!this.regLib.table.test(c))break;c=this.replaceHtmlTag(c),r.push(this.handleTr(c,s))}r.push("</table>")}return{html:r,index:i-1}},handleTr:function(t,e){for(var r=t.match(/[^|]+/g),i="<tr>",n=0,l=r.length;n<l;n++)i+='<td style="text-align:'+e[n]+'">'+this.handleInlineSet(r[n])+"</td>";return i+="</tr>"},handleTdAlign:function(t){for(var e=t.match(/[^|]+/g),r=[],i=0,n=e.length;i<n;i++)this.regLib.table_td_align_right.test(e[i])?r.push("right"):this.regLib.table_td_align_center.test(e[i])?r.push("center"):r.push("left");return r},handleTitle:function(t,e){var r=this;return t.replace(/(#{1,6})(.+)/,function(t,i,n){var l=i.length;return n=r.replaceHtmlTag(n),e.push('<a class="mdeditor-toc-'+l+'" href="#'+n+'">'+n+"</a>"),"<h"+l+' id="'+n+'" >'+n+"</h"+l+">"})},handleParagraph:function(t){return t=this.replaceHtmlTag(t),"<p>"+this.handleInlineSet(t)+"</p>"},handleInlineSet:function(t){return t=this.handleImg(t),t=this.handleInlineCode(t),t=this.handleLink(t),t=this.handleBold(t),t=this.handelItalic(t)},handleImg:function(t){return t.replace(this.regLib.img,function(t,e,r){return'<img class="mdeditor-img" alt="'+e+'" src="'+r+'">'})},handleLink:function(t){var e=this;return t.replace(e.regLib.a,function(t,r,i){return'<a href="'+i+'" target="'+e.options.aTarget+'">'+e.handleBold(r.replace(/\\([\(\)\[\])])/g,"$1"))+"</a>"})},handleBold:function(t){var e=this;return t.replace(e.regLib.b,function(t,e){return"<b>"+e+"</b>"})},handelItalic:function(t){var e=this;return t.replace(e.regLib.i,function(t,e){return"<i>"+e+"</i>"})},handleInlineCode:function(t){var e=this;return t.replace(e.regLib.inline_code,function(t,e){return'<span class="mdeditor-inline-code">'+e+"</span>"})},replaceHtmlTag:function(t){return t.replace(/\</g,"&lt;").replace(/\>/g,"&gt;")}},e.prototype.init.prototype=e.prototype,t.mdeditor=e}(window);