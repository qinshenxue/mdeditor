!function(t){var e=function(t){return new e.prototype.init(t)};e.version="1.2.0",e.getType=function(t){return Object.prototype.toString.call(t).match(/\[object\s(\w+)\]/)[1].toLowerCase()},e.addGrammar=function(t){return t in e||(e.prototype.grammar=[]),"array"==this.getType(t)?e.prototype.grammar=e.prototype.grammar.concat(t):e.prototype.grammar.push(t),e},e.prototype={constructor:e,init:function(t){var e=this,r={id:"",placeholder:"",name:"",aTarget:"_blank"};if(t&&t.id){e.copy(r,t);var n=this.getDom("#"+t.id),i='<textarea class="mdeditor" name="{{name}}" placeholder="{{placeholder}}"></textarea><div class="mdeditor-html"></div>';i=e.formatString(i,r),n.innerHTML=i;var a=this.getDom("#"+r.id+" .mdeditor"),l=this.getDom("#"+r.id+" .mdeditor-html");void 0===a.oninput?a.onkeyup=function(){e.markdownToHtml(this.value)}:a.oninput=function(){e.markdownToHtml(this.value)};var s="";a.onscroll=function(){"editor"==s&&(l.scrollTop=a.scrollTop/(a.scrollHeight-a.clientHeight)*(l.scrollHeight-l.clientHeight))},l.onscroll=function(){"editor2Html"==s&&(a.scrollTop=l.scrollTop/(l.scrollHeight-l.clientHeight)*(a.scrollHeight-a.clientHeight))},a.onmousemove=function(t){s="editor"},l.onmousemove=function(){s="editor2Html"},e.editor=a,e.editor2Html=l}return e.options=r,e},regLib:{code:/^\`{3}.*$/,ul:/^[\.\-\*]\s+.+$/,ol:/^\d+\.\s?.+$/,toc:/^\s*\[TOC\]\s*$/,img:/\!\[(.*?)\]\((.*?)\)/g,title:/^#{1,6}.+$/,a:/\[(.*?)\]\((.*?)\)/g,b:/\*\*(.+?)\*\*/g,i:/\*(.+?)\*/g,inline_code:/\`(.+?)\`/g,blockquote:/^>(.+?)$/,table:/^(\|[^|]+)+\|\s*$/,table_td_align:/^(\|\s*:?-+:?\s*)+\|\s*$/,table_td_align_left:/^\s*:-+\s*$/,table_td_align_center:/^\s*:-+:\s*$/,table_td_align_right:/^\s*-+:\s*$/},formatString:function(t,e){return t.replace(/{{(\w+)}}/g,function(t,r){return e[r]})},copy:function(t,e){for(var r in e)t[r]=e[r];return t},getDom:function(t){return document.querySelector(t)},getMarkdown:function(){return this.editor?this.editor.value:null},setMarkdown:function(t){return this.editor&&(this.editor.value=t),this.markdownToHtml(t)},getHTML:function(){return this.editor2Html?this.editor2Html.innerHTML:""},markdownToHtml:function(t){var e=t.match(/.+/gm)||[],r=[],n=e.length,i=0,a=null;n&&this.regLib.toc.test(e[0])&&(i=1,a=['<div class="mdeditor-toc">']);for(var l=i;n>l;l++){var s=e[l];if(this.regLib.title.test(s))r.push(this.handleTitle(s,a));else if(this.regLib.ul.test(s)){var o=this.handleUl(e,l);r=r.concat(o.html),l=o.index}else if(this.regLib.ol.test(s)){var h=this.handleOl(e,l);r=r.concat(h.html),l=h.index}else if(this.regLib.table.test(s)){var c=this.handleTable(e,l);r=r.concat(c.html),l=c.index}else if(this.regLib.blockquote.test(s)){var d=this.handleBlockquote(e,l);r=r.concat(d.html),l=d.index}else if(this.regLib.code.test(s)){var u=this.handlePre(e,l);r=r.concat(u.html),l=u.index}else{var g=this.matchGrammar(s);if(g){var p=g.handle.call(this,e,l,g);r=r.concat(p.html),l=p.index}else r.push(this.handleParagraph(s))}}return r=(a?a.join("")+"</div>":"")+r.join(""),this.editor2Html&&(this.editor2Html.innerHTML=r),r},matchGrammar:function(t){if(this.grammar&&this.grammar.length>0)for(var e=0,r=this.grammar.length;r>e;e++)if(this.grammar[e].reg.test(t))return this.grammar[e];return!1},handleBlockquote:function(t,e){var r=[],n=e;if(this.regLib.blockquote.test(t[e])){for(r.push('<blockquote class="mdeditor-blockquote">');n<t.length&&this.regLib.blockquote.test(t[n]);n++){var i=t[n].replace(/>/,"");if(this.regLib.ul.test(i)){var a=this.handleUl(t,n,/>/);r=r.concat(a.html),n=a.index}else if(this.regLib.ol.test(i)){var l=this.handleOl(t,n,/>/);r=r.concat(l.html),n=l.index}else r.push(this.handleParagraph(i))}r.push("</blockquote>")}return{html:r,index:n-1}},handleUl:function(t,e,r){var n=[],i=e;if(this.regLib.ul.test(r?t[e].replace(r,""):t[e])){for(n.push('<ul class="mdeditor-ul">');i<t.length;i++){var a=t[i];if(r&&(a=a.replace(r,"")),!this.regLib.ul.test(a))break;a=this.replaceHtmlTag(a),a=a.replace(/^[\.\*\-]\s*/,""),n.push("<li>"+this.handleInlineSet(a)+"</li>")}n.push("</ul>")}return{html:n,index:i-1}},handleOl:function(t,e,r){var n=[],i=e;if(this.regLib.ol.test(r?t[e].replace(r,""):t[e])){for(n.push('<ol class="mdeditor-ol">');i<t.length;i++){var a=t[i];if(r&&(a=a.replace(r,"")),!this.regLib.ol.test(a))break;a=this.replaceHtmlTag(a),a=a.replace(/^\d+\.\s*/,""),n.push("<li>"+this.handleInlineSet(a)+"</li>")}n.push("</ol>")}return{html:n,index:i-1}},handlePre:function(t,e){var r=[],n=e,i=t[e];if(this.regLib.code.test(i)){var a=i.replace(/[`\s]/g,"");for(r.push('<pre class="mdeditor-code mdeditor-code-'+a.toLowerCase()+'">'),r.push("<ol>"),n++;n<t.length;n++){var l=t[n];if(this.regLib.code.test(l))break;l=this.replaceHtmlTag(l),r.push("<li><div>"+this.handleCodeType(a,l)+"</div></li>")}r.push("</ol>"),r.push("</pre>")}return{html:r,index:n}},handleTable:function(t,e){var r=[],n=e,i=t[e],a=t[e+1];if(a&&this.regLib.table.test(i)&&this.regLib.table_td_align.test(a)){r.push('<table class="mdeditor-table">'),r.push("<tr>");for(var l=i.match(/[^|]+/g),s=this.handleTdAlign(a),o=0,h=l.length;h>o;o++)r.push('<th style="text-align:'+s[o]+'">'+this.replaceHtmlTag(l[o])+"</th>");for(r.push("</tr>"),n+=2;n<t.length;n++){var c=t[n];if(!this.regLib.table.test(c))break;c=this.replaceHtmlTag(c),r.push(this.handleTr(c,s))}r.push("</table>")}return{html:r,index:n-1}},handleTr:function(t,e){for(var r=t.match(/[^|]+/g),n="<tr>",i=0,a=r.length;a>i;i++)n+='<td style="text-align:'+e[i]+'">'+this.handleInlineSet(r[i])+"</td>";return n+="</tr>"},handleTdAlign:function(t){for(var e=t.match(/[^|]+/g),r=[],n=0,i=e.length;i>n;n++)this.regLib.table_td_align_right.test(e[n])?r.push("right"):this.regLib.table_td_align_center.test(e[n])?r.push("center"):r.push("left");return r},handleTitle:function(t,e){var r=this;return t.replace(/(#{1,6})(.+)/,function(t,n,i){var a=n.length;return i=r.replaceHtmlTag(i),e&&e.push('<a class="mdeditor-toc-'+a+'" href="#'+i+'">'+i+"</a>"),"<h"+a+' id="'+i+'" >'+i+"</h"+a+">"})},handleParagraph:function(t){return t=this.replaceHtmlTag(t),"<p>"+this.handleInlineSet(t)+"</p>"},handleInlineSet:function(t){return t=this.handleImg(t),t=this.handleInlineCode(t),t=this.handleLink(t),t=this.handleBold(t),t=this.handelItalic(t)},handleImg:function(t){return t.replace(this.regLib.img,function(t,e,r){return'<img class="mdeditor-img" alt="'+e+'" src="'+r+'">'})},handleLink:function(t){var e=this;return t.replace(e.regLib.a,function(t,r,n){return r=e.handleBold(r),'<a href="'+n+'" target="'+e.options.aTarget+'">'+r+"</a>"})},handleBold:function(t){var e=this;return t.replace(e.regLib.b,function(t,e){return"<b>"+e+"</b>"})},handelItalic:function(t){var e=this;return t.replace(e.regLib.i,function(t,e){return"<i>"+e+"</i>"})},handleInlineCode:function(t){var e=this;return t.replace(e.regLib.inline_code,function(t,e){return'<span class="mdeditor-inline-code">'+e+"</span>"})},handleCodeType:function(t,e){switch(t){case"javascript":return this.highlightJs(e);case"css":return e.replace(/([a-zA-Z-]+:)([^;\{]+)(;)/g,'<span class="css-property-name">$1</span><span class="css-property-value">$2</span><span class="css-semicolon">$3</span>');case"xml":return e.replace(/(&lt;\/?)(\w+)(.*?)(&gt;)/g,'<span class="xml-lt">$1</span><span class="xml-tag-name">$2</span><span class="xml-tag-attr">$3</span><span class="xml-gt">$4</span>');default:return e}},highlightJs:function(t){var e=["break","case","catch","continue","default","delete","do","else","finally","for","function","if","in","instanceof","new","return","switch","this","throw","try","typeof","var","void","while","with"],r=new RegExp("\\b("+e.join("|")+")\\b","g");return t.replace(/('|").*?('|")/g,function(t){return'<span class="js-string">'+t+"</span>"}).replace(r,function(t){return'<span class="js-keyword">'+t+"</span>"}).replace(/\/\/.+$/,function(t){return'<span class="js-line-comment">'+t+"</span>"})},replaceHtmlTag:function(t){return t.replace(/\</g,"&lt;").replace(/\>/g,"&gt;")}},e.prototype.init.prototype=e.prototype,t.mdeditor=e}(window);